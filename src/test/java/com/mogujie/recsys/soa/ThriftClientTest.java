/* * Copyright (c) 2016. mogujie */package com.mogujie.recsys.soa;import com.thrift.zk.soa.pool.ThriftPoolConfig;import com.thrift.zk.soa.thrift.client.ThriftClient;import com.thrift.zk.soa.thrift.route.RouteEnum;import com.thrift.zk.soa.utils.Constant;import com.mogujie.recsys.soa.idl.UserService;import org.apache.thrift.TException;import org.junit.Test;/** * Author: xiajungetResult * Date: 16/11/01 03:31 */public class ThriftClientTest {    @Test    public void test() throws TException, InterruptedException {        ThriftPoolConfig config = new ThriftPoolConfig();        config.setZkAddress("10.13.128.214:2181");//zookeeper集群地址        config.setJdns("/jdns/si/server");//服务端使用的节点        config.setZkConnTimeout(60000);       // config.setClientClass(UserInfo.Client.class);//本地模式时使用，设置client        config.setConnTotal(3);//client会对每个server创建最多10个连接        config.setUseZk(true);//使用zookeeper管理client        //config.setHosts("127.0.0.1:9091"); //本地模式时直连rpc服务        config.setProtocol(Constant.Protocol.TCOMPACTPROTOCOL);//thrift通信压缩模式        config.setRoute(RouteEnum.RANDOM);//客户端设置的路由策略，如果服务端设置过，这次设置将被服务端的设置覆盖        ThriftClient thriftClient = new ThriftClient(config);        //UserInfo.Iface client = (UserInfo.Iface) thriftClient.getClient();//获取thrift客户端        final UserService.Iface client = (UserService.Iface) thriftClient.getClient(UserService.Client.class);        for (int j = 0; j < 5;j++){            new Thread(new Runnable(){                @Override                public void run() {                    for (int i = 0; i < 3; i++) {                        try {                            String sex = client.getSex();                            System.out.println(i + "--------" + sex);                            Thread.sleep(1000);                        } catch (Exception e) {                            System.out.println(i + "--------");                        }                    }                }            }).start();        }        Thread.sleep(140000);        System.out.println("---------");    }}